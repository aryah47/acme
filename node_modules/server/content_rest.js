//content_rest.js

var dbapi = require('server/dbapi');
module.exports = {
    main : function (app) {
        app.get('/api/content', function (req, res) {
            dbapi.readAll('Contents', req.query).done(function (acc) {
                return res.send(acc);
            });
        });

        var reqToContVal = function (req) {
            var dictValues = {};

            req.body.revId ? dictValues.revId = req.body.revId : null;
            req.body.markup ? dictValues.markup = req.body.markup : null;
            req.body.markupType ? dictValues.markupType = req.body.markupType : null;
            req.body.data ? dictValues.data = req.body.data : null;
            req.body.filePath ? dictValues.filePath = req.body.filePath : null;
            req.body.fileUrl ? dictValues.fileUrl = req.body.fileUrl : null;
            req.body.fileService ? dictValues.fileService = req.body.fileService : null;
            req.body.mimeType ? dictValues.mimeType = req.body.mimeType : null;
            return dictValues;
        };

        app.post('/api/content', function (req, res) {
            dbapi.create('Contents', reqToContVal(req)).done(function (info) {
                return res.send(info);
            });
        });

        app.get('/api/content/:id', function (req, res) {
            res.send('content');
        });
        var fnContentUpdate = function (req, res) {
            var id = req.params.id;
            dbapi.update('Contents', id, reqToContVal(req)).done(function (info) {
                return res.send(info);
            });
        };
        app.put('/api/content/:id', fnContentUpdate);
        app.patch('/api/content/:id', fnContentUpdate);

        app.delete('/api/content/:id', function (req, res) {
            var id = req.params.id;
            dbapi.del('Contents', id).done(function (info) {
                return res.send(info);
            });
        });
        return app;
    }
};
