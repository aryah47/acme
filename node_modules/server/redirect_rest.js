//redirect_rest.js

var dbapi = require('server/dbapi');
module.exports = {
    main : function (app) {
        app.get('/api/redirect', function (req, res) {
            dbapi.readAll('Redirects', req.query).done(function (acc) {
                return res.send(acc);
            });
        });
        var reqToRedirVal = function (req) {
            var dictValues = {};

            req.body.revId ? dictValues.revId = req.body.revId : null;
            req.body.redirUrl ? dictValues.redirUrl = req.body.redirUrl : null;
            req.body.urlChange ? dictValues.urlChange = req.body.urlChange : null;
            return dictValues;
        };
        app.post('/api/redirect', function (req, res) {
            dbapi.create('Redirects', reqToRedirVal(req)).done(function (info) {
                return res.send(info);
            });
        });
        app.get('/api/redirect/:id', function (req, res) {
            var id = req.params.id;
            dbapi.read('Redirects', id).done(function(row) {
                return res.send(row);
            });
        });
        var fnRedirUpdate = function (req, res) {
            var id = req.params.id;
            dbapi.update('Redirects', id, reqToRedirVal(req)).done(function (info) {
                return res.send(info);
            });
        };
        app.put('/api/redirect/:id', fnRedirUpdate);
        app.patch('/api/redirect/:id', fnRedirUpdate);
        app.delete('/api/redirect/:id', function (req, res) {
            var id = req.params.id;
            dbapi.del('Redirects', id).done(function (info) {
                return res.send(info);
            });
        });
        return app;
    }
};
