//page_rest.js

var dbapi = require('server/dbapi');
module.exports = {
    main : function (app) {

        app.get('/api/page', function (req, res) {
            dbapi.readAll('Pages', req.query).done(function (acc) {
                return res.send(acc);
            })
        });
        var reqToPgVal = function (req) {
            var dictValues = {};
            console.log
            if (req.body.url) {
                dictValues.url = req.body.url;
            }
            if (req.body.activeNsId) {
                dictValues.activeNsId = req.body.activeNsId;
            }
            if (req.body.activeCatPgId) {
                dictValues.activeCatPgId = req.body.activeCatPgId;
            }
            //if (req.body.activeName) {
            //    dictValues.activeName = req.body.activeName;
            //}
            if (req.body.activeContId) {
                dictValues.activeContId = req.body.activeContId;
            }
            if (req.body.activeTmplId) {
                dictValues.activeTmplId = req.body.activeTmplId;
            }
            if (req.body.activeRedirUrl) {
                dictValues.activeRedirUrl = req.body.activeRedirUrl;
            }
            if (req.body.activeUrlChange) {
                dictValues.activeUrlChange = req.body.activeUrlChange;
            }

            return dictValues;
        };
        app.post('/api/page', function (req, res) {
            dbapi.create('Pages', reqToPgVal(req)).done(function (info) {
                return res.send(info);
            });
        });
        app.get('/api/page/:id', function (req, res) {
            var id = req.params.id;
            dbapi.read('Pages', id).done(function (row) {
                return res.send(row);
            });
        });
        var fnPgUpdate = function (req, res) {
            var id = req.params.id;
            dbapi.update('Pages', id, reqToPgVal(req)).done(function (info) {
                return res.send(info);
            });
        };
        app.put('/api/page/:id', fnPgUpdate);
        app.patch('/api/page/:id', fnPgUpdate);
        app.delete('/api/page/:id', function (req, res) {
            var id = req.params.id;
            dbapi.del('Pages', id).done(function (info) {
                return res.send(info);
            });
        });
        return app;
    }
};
